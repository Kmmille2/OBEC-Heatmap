<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>OBEC Coverage Map</title>

<style>
  html,body,#map{margin:0;height:100%;width:100%}
</style>

<!-- Mapbox GL assets (no defer on the JS) -->
<link  href="https://api.mapbox.com/mapbox-gl-js/v2.16.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.16.0/mapbox-gl.js"></script>
</head><body>

<div id="map"></div>

<script>
/* === Wix / CSP worker fix === */
mapboxgl.workerUrl   = 'https://api.mapbox.com/mapbox-gl-js/v2.16.0/mapbox-gl-csp-worker.js';
mapboxgl.workerCount = 2;

/* === Public token === */
mapboxgl.accessToken =
  'pk.eyJ1Ijoia3lsZS1taWxsZXIiLCJhIjoiY21hNWVya2RzMGlycjJpbzl4OW1kaGtodiJ9.u5I5rSYZSB1pqdX7rjudQw';

/* === Colours & gradient === */
const heatGradient = [
  'interpolate',['linear'],['heatmap-density'],
  0,'rgba(167,154,248,0)',
  .3,'rgba(167,154,248,.5)',
  .6,'rgba(147,41,19,.7)',
  1,'rgba(147,41,19,.9)'
];
const pinColor  = '#932913';            // dark red pins
const circleClr = 'rgba(167,154,248,.18)'; // light purple coverage fill

/* === Service hubs === */
const points = [
  {n:'East Windsor NJ',lat:40.267,lng:-74.525,r:50,w:1},
  {n:'New Castle DE',  lat:39.687,lng:-75.586,r:50,w:1},
  {n:'Wake Forest NC', lat:35.979,lng:-78.507,r:50,w:1}
];
const feat = {
  type:'FeatureCollection',
  features: points.map(p=>({
    type:'Feature',
    geometry:{type:'Point',coordinates:[p.lng,p.lat]},
    properties:{weight:p.w}
  }))
};

/* === Build the map === */
const map = new mapboxgl.Map({
  container:'map',
  style:'mapbox://styles/mapbox/light-v11',
  center:[-76.5,38.5],  // Mid-Atlantic view
  zoom:5,
  attributionControl:false
});

map.on('load', () => {
  /* heatmap layer */
  map.addSource('hubs',{type:'geojson',data:feat});
  map.addLayer({
    id:'heat',type:'heatmap',source:'hubs',maxzoom:9,
    paint:{
      'heatmap-weight':['get','weight'],
      'heatmap-color':heatGradient,
      'heatmap-radius':60,
      'heatmap-opacity':.8
    }
  });

  /* pins + coverage circles */
  points.forEach(p=>{
    /* pin */
    new mapboxgl.Marker({color:pinColor})
      .setLngLat([p.lng,p.lat])
      .setPopup(new mapboxgl.Popup({offset:25}).setText(p.n))
      .addTo(map);

    /* circle source */
    map.addSource(p.n+'-c',{type:'geojson',
      data:{type:'Feature',geometry:{type:'Point',coordinates:[p.lng,p.lat]}}
    });

    /* circle layer */
    map.addLayer({
      id:p.n+'-cLayer',type:'circle',source:p.n+'-c',
      paint:{
        'circle-radius':{stops:[[0,0],[20,p.r*1609/2]],base:2},
        'circle-color':circleClr,
        'circle-stroke-color':pinColor,
        'circle-stroke-width':1
      }
    });
  });
});
</script>
</body></html>
